//==============================================================================
// MICROSOFT DEFENDER KQL DETECTION - WEB EXPLOIT
//==============================================================================
// Rule: Suspicious Web Server Process
// ID: KQL-WEB-001
// Author: Mathan
// Date: 2025-12-02
// MITRE: T1505 (Server Software Component)
// Severity: CRITICAL
//==============================================================================

DeviceProcessEvents
| where InitiatingProcessFileName in~ ("w3wp.exe", "httpd.exe", "nginx.exe")
| where FileName in~ ("cmd.exe", "powershell.exe", "bash")
| project TimeGenerated, DeviceName, InitiatingProcessFileName, FileName, ProcessCommandLine
| extend Severity = "CRITICAL"
